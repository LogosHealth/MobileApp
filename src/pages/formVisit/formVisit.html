<ion-header>
  <ion-navbar>
    <ion-title>Visit Form</ion-title>
    <ion-buttons right>
        <button ion-button icon-only (click)="presentPopover($event)">
            <ion-icon name='add'></ion-icon>
          </button>
          <button ion-button icon-only (click)="attachRecord()">
          <ion-icon name='attach'></ion-icon>
        </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content class="forms-examples-content"  [formGroup]="card_form" (ngSubmit)="saveRecord()">
    <div>
        <ion-segment [(ngModel)]="categoryList" [ngModelOptions]="{standalone: true}" class="forms-examples-segment">
          <ion-segment-button class="segment-button" value="pre">
            Pre
          </ion-segment-button>
          <ion-segment-button class="segment-button" value="post">
            Post
          </ion-segment-button>
        </ion-segment>

        <div [ngSwitch]="categoryList">
          <div *ngSwitchCase="'pre'">
            <ion-card class="sample-form">
              <ion-row>
                <ion-col no-padding>
                  <ion-item>
                    <ion-label floating>Physician</ion-label>
                    <ion-input type="text" formControlName="physiciantitle" [disabled]="true"></ion-input>
                  </ion-item>
                </ion-col>
              </ion-row>
              <ion-row>
                <ion-col no-padding width-60>
                  <ion-item>
                    <ion-label floating>Visit Date</ion-label>
                    <ion-datetime displayFormat="MMM-DD-YYYY hh:mm A"  formControlName="visitdate" minuteValues="0,15,30,45"></ion-datetime>
                  </ion-item>
                </ion-col>
                <ion-col no-padding width-35>
                  <ion-item>
                    <ion-label floating>For</ion-label>
                    <ion-input type="text" formControlName="firstname" [disabled]="true"></ion-input>
                  </ion-item>
                </ion-col>
              </ion-row>
              <ion-row>
                <ion-col no-padding>
                  <ion-item>
                    <ion-label floating>Reason</ion-label>
                    <ion-textarea type="text" formControlName="reason" autosize></ion-textarea>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-card>

            <ion-card  class="sample-form">
              <h2 class = "section-title" >Important Info</h2>
              <div formArrayName="infos" *ngFor="let info of card_form.get('infos').controls; let i = index;">
                <ion-row [formGroupName]="i">
                  <ion-col no-padding width-50>
                    <ion-item  text-wrap>
                      <ion-label *ngIf="info.value.type !== null" floating>{{info.value.type}}</ion-label>
                      <ion-label *ngIf="info.value.type == null" floating>Name</ion-label>
                      <ion-input type="text" formControlName="namevalue" [disabled]="true">{{info.namevalue}}</ion-input>
                    </ion-item>
                  </ion-col>
                  <ion-col no-padding width-50>
                    <ion-item text-wrap>
                      <ion-label floating>Date</ion-label>
                      <ion-input type="text" formControlName="dateofmeasure" [disabled]="true">{{info.dateofmeasure}}</ion-input>
                    </ion-item>
                  </ion-col>
                </ion-row>
              </div>

              <ion-row>
                <ion-col no-padding width-68>
                  <ion-item>
                    <ion-label floating>Important Info Category</ion-label>
                    <ion-select formControlName="importantinfo">
                      <ion-option class="section-title" value="condition">Condition</ion-option>
                      <ion-option class="section-title" value="symptom">Symptom</ion-option>
                      <ion-option class="section-title" value="temperature">Temperature</ion-option>
                      <ion-option class="section-title" value="mood">Mood</ion-option>
                    </ion-select>
                  </ion-item>
                </ion-col>
                <ion-col class="columnAlign" no-padding width-30>
                  <button ion-button block class="form-action-button"  type="button" [disabled]="categoryEmpty()" (click)="addInfo()">Add</button>
                </ion-col>
              </ion-row>
            </ion-card>

            <ion-card  class="sample-form">
              <ion-row>
                <ion-col no-padding width-68>
                  <h2 class = "section-title" >Key Questions</h2>
                </ion-col>
                <ion-col class="columnAligntoLabel"  no-padding width-30>
                  <button ion-button block class="form-action-button"  type="button" (click)="addQuestion()">Add</button>
                </ion-col>
              </ion-row>
              <div formArrayName="questions" *ngFor="let info of card_form.get('questions').controls; let i = index;">
                <div [formGroupName]="i">
                  <ion-row>
                    <ion-item  text-wrap>
                      <ion-label floating>Question {{ i + 1 }}</ion-label>
                      <ion-textarea type="text" formControlName="question" autosize></ion-textarea>
                    </ion-item>
                  </ion-row>
                  <ion-row>
                    <ion-item  text-wrap>
                      <ion-label floating>Answer</ion-label>
                      <ion-textarea type="text" formControlName="answer" autosize></ion-textarea>
                    </ion-item>
                  </ion-row>
                </div>
              </div>
            </ion-card>

            <ion-card  class="sample-form">
              <ion-row>
                <ion-col no-padding width-68>
                  <h2 class = "section-title" >Tasks</h2>
                </ion-col>
                <ion-col class="columnAligntoLabel" no-padding width-30>
                  <button ion-button block class="form-action-button"  type="button" (click)="addTodo()">Add</button>
                </ion-col>
              </ion-row>

              <div formArrayName="todos" *ngFor="let info of card_form.get('todos').controls; let i = index;">
                <ion-row [formGroupName]="i">
                  <ion-col class="columnAlignLeft" no-padding width-5>
                    <ion-checkbox formControlName="completedflag" (click)="setChecked(i)"></ion-checkbox>
                  </ion-col>
                  <ion-col class="columnAlignLeft2" no-padding width-40>
                    <ion-item  text-wrap>
                      <ion-label floating>Task {{ i + 1 }}</ion-label>
                      <ion-input type="text" formControlName="taskname" (focusout)="syncTaskName(i)" [disabled]="isComplete(i)"></ion-input>
                    </ion-item>
                  </ion-col>
                  <ion-col no-padding width-40>
                    <ion-item text-wrap>
                      <ion-label floating>Task Date</ion-label>
                      <ion-datetime displayFormat="MMM-DD hh:mm A" formControlName="duedate" (focusout)="syncDueDate(i)" [disabled]="isComplete(i)"></ion-datetime>
                    </ion-item>
                  </ion-col>
                  <ion-col class="columnInline" no-padding width-10 *ngIf="curRec.recordid !==null">
                    <button ion-button block class="form-action-button"  type="button" (click)="checkReminder(i)" [disabled]="isComplete(i) || pastDue(i) || notReady(i)">
                      <ion-icon name="alarm"></ion-icon>
                    </button>
                  </ion-col>
                </ion-row>
              </div>

              <section class="form-section">
                <ion-row no-padding class="multi-input-row">
                  <ion-col class="columnInline" no-padding width-49 *ngIf="curRec.recordid !==null">
                    <button ion-button block class="form-action-button" type="button" (click)="saveRecord()" [disabled]="!card_form.dirty || !card_form.valid">Save</button>
                  </ion-col>
                  <ion-col class="columnInline"no-padding width-49 *ngIf="curRec == undefined || curRec.recordid == null">
                    <button ion-button block class="form-action-button" type="button" (click)="saveRecord()" [disabled]="!card_form.dirty || !card_form.valid">Schedule</button>
                  </ion-col>
                  <ion-col class="columnInline" no-padding width-49 *ngIf="curRec.recordid !==null">
                    <button ion-button block class="form-action-button" type="button" (click)="deleteRecord()" [disabled]="newRec">Cancel Visit</button>
                  </ion-col>
                  <ion-col class="columnInline" no-padding width-49 *ngIf="curRec == undefined || curRec.recordid == null">
                    <button ion-button block class="form-action-button" type="button" (click)="deleteRecord()" [disabled]="newRec">Cancel Reminder</button>
                  </ion-col>
                </ion-row>
              </section>
            </ion-card>
          </div>
        </div>

        <div [ngSwitch]="categoryList">
          <div  *ngSwitchCase="'post'">
            <ion-card class="sample-form">
              <ion-row>
                <ion-col no-padding width-68>
                  <h2 class = "section-title" >Diagnosis</h2>
                </ion-col>
                <ion-col class="columnAligntoLabel"  no-padding width-30>
                  <button ion-button block class="form-action-button"  type="button" (click)="addDiagnosis()">Add</button>
                </ion-col>
              </ion-row>
              <div formArrayName="diagnoses" *ngFor="let info of card_form.get('diagnoses').controls; let i = index;">
                <div [formGroupName]="i">
                  <ion-row>
                    <ion-col class="columnAlignLeft" no-padding width-5>
                      <ion-checkbox formControlName="resolved" (click)="setResolved(i)"></ion-checkbox>
                    </ion-col>
                    <ion-col no-padding width-72>
                      <ion-item>
                        <ion-label floating>Diagnosis {{ i + 1 }}</ion-label>
                        <ion-input type="text" formControlName="medicalevent"></ion-input>
                      </ion-item>
                    </ion-col>
                    <ion-col class="columnAlign" no-padding width-10>
                      <button ion-button block class="form-action-button"  type="button" (click)="presentPopover($event)">
                        <ion-icon name="ice-cream"></ion-icon>
                      </button>
                    </ion-col>
                    <ion-col class="columnAlign" no-padding width-10>
                        <button ion-button block class="form-action-button"  type="button" (click)="updateDiagnosis(i)">
                          <ion-icon name="share-alt"></ion-icon>
                        </button>
                    </ion-col>
                  </ion-row>
                </div>
              </div>
            </ion-card>
            <ion-card class="sample-form">
                <ion-row>
                  <ion-col no-padding width-68>
                    <h2 class = "section-title" >Outcomes</h2>
                  </ion-col>
                  <ion-col class="columnAligntoLabel"  no-padding width-30>
                    <button ion-button block class="form-action-button"  type="button" (click)="addOutcomes()">Add</button>
                  </ion-col>
                </ion-row>
                <div formArrayName="outcomes" *ngFor="let info of card_form.get('outcomes').controls; let i = index;">
                  <div [formGroupName]="i">
                    <ion-row>
                      <ion-col no-padding width-87>
                        <ion-item>
                          <ion-label floating>Outcome {{ i + 1 }}</ion-label>
                          <ion-input type="text" formControlName="medicalevent"></ion-input>
                        </ion-item>
                      </ion-col>
                      <ion-col class="columnAlign" no-padding width-10>
                          <button ion-button block class="form-action-button"  type="button" (click)="updateOutcome(i)">
                            <ion-icon name="share-alt"></ion-icon>
                          </button>
                      </ion-col>
                    </ion-row>
                  </div>
                </div>
                <section class="form-section">
                    <ion-row no-padding class="multi-input-row">
                      <ion-col class="columnInline" no-padding width-50>
                        <button ion-button block class="form-action-button" type="button" (click)="saveRecord()" [disabled]="!card_form.dirty || curRec.recordid==null">Save</button>
                      </ion-col>
                    </ion-row>
                  </section>
              </ion-card>
          </div>
        </div>
    </div>
</ion-content>
